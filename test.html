<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <link rel="stylesheet" href="css/style.css">
  <meta name="description" content="">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <meta property="og:image:alt" content="">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.png">

  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#fafafa">
  <script src="//unpkg.com/alpinejs" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/beercss@3.6.8/dist/cdn/beer.min.css" rel="stylesheet" />

  <script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("alpineMuliSelect", (obj) => ({
        elementId: obj.elementId,
        options: [],
        selected: obj.selected,
        selectedElms: [],
        show: false,
        search: '',
        open() {
          this.show = true
        },
        close() {
          this.show = false
        },
        toggle() {
          this.show = !this.show
        },
        isOpen() {
          return this.show === true
        },

        // Initializing component
        init() {
          const options = document.getElementById(this.elementId).options;
          for (let i = 0; i < options.length; i++) {

            this.options.push({
              value: options[i].value,
              text: options[i].innerText,
              search: options[i].dataset.search,
              selected: Object.values(this.selected).includes(options[i].value)
            });

            if (this.options[i].selected) {
              this.selectedElms.push(this.options[i])
            }
          }

          // searching for the given value
          this.$watch("search", (e => {
            this.options = []
            const options = document.getElementById(this.elementId).options;
            Object.values(options).filter((el) => {
              var reg = new RegExp(this.search, 'gi');
              return el.dataset.search.match(reg)
            }).forEach((el) => {
              let newel = {
                value: el.value,
                text: el.innerText,
                search: el.dataset.search,
                selected: Object.values(this.selected).includes(el.value)
              }
              this.options.push(newel);
            })
          }));
        },
        // clear search field
        clear() {
          this.search = ''
        },
        // deselect selected options
        deselect() {
          setTimeout(() => {
            this.selected = []
            this.selectedElms = []
            Object.keys(this.options).forEach((key) => {
              this.options[key].selected = false;
            })
          }, 100)
        },
        // select given option
        select(index, event) {
          if (!this.options[index].selected) {
            this.options[index].selected = true;
            this.options[index].element = event.target;
            this.selected.push(this.options[index].value);
            this.selectedElms.push(this.options[index]);

          } else {
            this.selected.splice(this.selected.lastIndexOf(index), 1);
            this.options[index].selected = false
            Object.keys(this.selectedElms).forEach((key) => {
              if (this.selectedElms[key].value == this.options[index].value) {
                setTimeout(() => {
                  this.selectedElms.splice(key, 1)
                }, 100)
              }
            })
          }
        },
        // remove from selected option
        remove(index, option) {
          this.selectedElms.splice(index, 1);
          Object.keys(this.options).forEach((key) => {
            if (this.options[key].value == option.value) {
              this.options[key].selected = false;
              Object.keys(this.selected).forEach((skey) => {
                if (this.selected[skey] == option.value) {
                  this.selected.splice(skey, 1);
                }
              })
            }
          })
        },
        // filter out selected elements
        selectedElements() {
          return this.options.filter(op => op.selected === true)
        },
        // get selected values
        selectedValues() {
          return this.options.filter(op => op.selected === true).map(el => el.value)
        }
      }));
    });
  </script>
</head>

<body>

  <!-- Add your site or application content here -->
  <p>Hello world! This is HTML5 Boilerplate.</p>

  <div class="w-full" x-data="alpineMuliSelect({selected:['te_11', 'te_12'], elementId:'multSelect'})">

    <!-- Select Options -->
    <select class="hidden" id="multSelect">
      <option value="te_1" data-search="arsenal">Arsenal</option>
      <option value="te_2" data-search="aston villa">Aston Villa</option>
      <option value="te_3" data-search="Brentford">Brentford</option>
      <option value="te_4" data-search="Brighton">Brighton</option>
      <option value="te_5" data-search="Burnley">Burnley</option>
      <option value="te_6" data-search="Chelsea">Chelsea</option>
      <option value="te_7" data-search="Crystal Palace">Crystal Palace</option>
      <option value="te_8" data-search="Everton">Everton</option>
      <option value="te_10" data-search="Leeds">Leeds</option>
      <option value="te_9" data-search="Leicester">Leicester</option>
      <option value="te_11" data-search="Liverpool">Liverpool</option>
      <option value="te_12" data-search="Manchester City">Man City</option>
      <option value="te_13" data-search="Manchester Utd">Man Utd</option>
      <option value="te_14" data-search="Newcastle">Newcastle</option>
      <option value="te_15" data-search="Norwich">Norwich</option>
      <option value="te_16" data-search="Southampton">Southampton</option>
      <option value="te_17" data-search="Tottenham Hotspur spurs">Spurs</option>
      <option value="te_18" data-search="Watford">Watford</option>
      <option value="te_19" data-search="West Ham">West Ham</option>
      <option value="te_20" data-search="Wolves">Wolves</option>
    </select>

    <div class="w-full flex flex-col items-center h-64 mx-auto" @keyup.alt="toggle">
      <input name="teams[]" type="hidden" x-bind:value="selectedValues()">
      <div class="flex flex-auto flex-wrap" x-on:click="open">
        <!-- iterating over selected elements -->
        <template x-for="(option,index) in selectedElms" :key="option.value">
          <div x-show="index < 2"
          >
            <div
              x-model="selectedElms[option]" x-text="option.text"></div>
            <div>
              <div x-on:click.stop="remove(index,option)">
                X
              </div>
            </div>
          </div>
        </template>
        <div x-show="selectedElms.length > 2">
          <div>
               <span>
                <span x-text="selectedElms.length -2"></span>
                 </span>
            more selected
          </div>
        </div>
        <!-- None items selected -->
        <div x-show="selectedElms.length == 0" class="flex-1">
          <input placeholder="Select teams"
                 class="bg-transparent p-1 px-2 appearance-none outline-none h-full w-full text-gray-800"
                 x-bind:value="selectedElements()">
        </div>
      </div>
    </div>
  </div>

  <div x-data="{ open: false }">
    <button @click="open = !open">Expand</button>

    <span  x-show="open">
        Content...
    </span>
  </div>
  <script src="js/app.js"></script>
</body>

</html>
